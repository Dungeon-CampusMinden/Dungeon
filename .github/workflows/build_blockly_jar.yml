name: Build and Publish JAR (Manual)

on:
  workflow_dispatch:

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout source
        uses: actions/checkout@v4

      - name: Set up JDK 21
        uses: actions/setup-java@v4
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Make Gradle executable
        run: chmod +x gradlew

      - name: Build JAR
        run: ./gradlew build

      - name: Run JAR
        run: |
          JAR=$(ls build/libs/*.jar | head -n 1)
          echo "Running $JAR"
          java -jar "$JAR"

      - name: Publish to _blocklyjar branch
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"

          # Neue orphan branch erzeugen
          git checkout --orphan _blocklyjar

          # Alles l√∂schen
          git rm -rf . || true

          # Artefakte kopieren
          mkdir artifacts
          cp build/libs/*.jar artifacts/

          git add artifacts
          git commit -m "Update JAR artifacts"
          git push origin _blocklyjar --force