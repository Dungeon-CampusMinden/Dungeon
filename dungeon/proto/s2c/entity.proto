// Entity-related server messages.

syntax = "proto3";

package dungeon.s2c;

import "common/common_types.proto";

option java_multiple_files = true;
option java_package = "core.network.proto.s2c";
option java_outer_classname = "EntityProto";

// Server-to-client: New entity spawned.
// Maps to: core.network.messages.s2c.EntitySpawnEvent
message EntitySpawnEvent {
  // Unique entity identifier.
  int32 entity_id = 1;

  // Initial position/orientation in world.
  dungeon.common.PositionInfo position = 2;

  // Visual representation info.
  DrawInfo draw_info = 3;

  // Whether entity persists across level reloads.
  bool is_persistent = 4;

  // Player-specific info (only for player entities).
  optional PlayerInfo player_info = 5;

  // Character class ID (maps to CharacterClass enum ordinal).
  optional int32 character_class_id = 6;
}

// Server-to-client: Batch spawn multiple entities.
message EntitySpawnBatch {
  repeated EntitySpawnEvent entities = 1;
}

// Visual/rendering information for an entity.
message DrawInfo {
  // Path to the entity's texture or sprite sheet.
  string texture_path = 1;

  // X scale factor (default 1.0).
  optional float scale_x = 2;

  // Y scale factor (default 1.0).
  optional float scale_y = 3;

  // Current animation state.
  optional AnimationInfo current_animation = 4;

  // Animation timing and behavior config (always present).
  AnimationConfigInfo animation_config = 5;

  // Spritesheet slicing geometry (only for spritesheet entities).
  optional SpritesheetConfigInfo spritesheet_config = 6;
}

// Animation state information.
message AnimationInfo {
  // Name of the current animation.
  string animation_name = 1;

  // Current frame index in animation.
  int32 current_frame = 2;
}

// Animation timing and behavior configuration.
message AnimationConfigInfo {
  // Number of update ticks each sprite frame is displayed for.
  int32 frames_per_sprite = 1;

  // Whether the animation loops.
  bool looping = 2;

  // Whether sprites are drawn centered.
  bool centered = 3;

  // Whether sprites are drawn horizontally mirrored.
  bool mirrored = 4;
}

// Spritesheet slicing geometry.
message SpritesheetConfigInfo {
  // Width of one sprite frame in pixels.
  int32 sprite_width = 1;

  // Height of one sprite frame in pixels.
  int32 sprite_height = 2;

  // X offset (pixels) of the first sprite in the sheet.
  int32 offset_x = 3;

  // Y offset (pixels) of the first sprite in the sheet.
  int32 offset_y = 4;

  // Number of rows in the spritesheet grid.
  int32 rows = 5;

  // Number of columns in the spritesheet grid.
  int32 columns = 6;
}

// Player-specific information.
message PlayerInfo {
  // Display name of the player.
  string player_name = 1;

  // Whether this is the receiving client's own player.
  bool is_local_player = 2;
}

// Server-to-client: Entity despawned/removed.
// Maps to: core.network.messages.s2c.EntityDespawnEvent
message EntityDespawnEvent {
  // ID of the despawned entity.
  int32 entity_id = 1;

  // Reason for despawn.
  string reason = 2;
}

// Entity state for snapshot updates.
// Maps to: core.network.messages.s2c.EntityState
message EntityState {
  // Required: Entity identifier.
  int32 entity_id = 1;

  // Optional: Entity display name.
  optional string entity_name = 2;

  // Optional: Current position/orientation.
  optional dungeon.common.PositionInfo position = 3;

  // Optional: Current health points.
  optional int32 current_health = 4;

  // Optional: Maximum health points.
  optional int32 max_health = 5;

  // Optional: Current mana points.
  optional float current_mana = 6;

  // Optional: Maximum mana points.
  optional float max_mana = 7;

  // Optional: Current state name.
  optional string state_name = 8;

  // Optional: Tint color overlay (packed RGBA).
  optional int32 tint_color = 9;

  // Optional: Inventory contents.
  repeated ItemSlot inventory = 10;
}

// Represents a slot in an inventory.
message ItemSlot {
  // Slot index.
  int32 slot_index = 1;

  // Item in this slot (absent if slot is empty).
  optional dungeon.common.Item item = 2;
}
